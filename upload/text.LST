SQL> @ "C:\Users\Akash Milton\Google Drive\dropittome\dbms\ex3_1_2.sql";
SQL> REM 1. Display the food details that is not purchased by any of customers.
SQL> 
SQL> select *
  2  from products
  3  where pid NOT IN (select item
  4  		      from item_list);

PID             FLAVOR     FOOD            PRICE                                
--------------- ---------- ---------- ----------                                
20-BC-C-10      Chocolate  Cake             8.95                                

SQL> 
SQL> REM 2. Show the customer details who had placed more than 2 orders on the same date
SQL> 
SQL> select *
  2  from customers
  3  where cid in (select cid
  4  		   from receipts
  5  		  having count(*)>2
  6  		  group by(cid,rdate));

       CID FNAME                LNAME                                           
---------- -------------------- --------------------                            
         8 HELING               RUPERT                                          
        14 SOPKO                RAYFORD                                         

SQL> 
SQL> REM 3. Display the products details that is ordered for maximum by the customers
SQL> 
SQL>  select *
  2   from products
  3   where pid=(select item from item_list
  4  		 group by item
  5  		  having count(*)=(select count(*)
  6  				   from item_list
  7  				   group by item
  8  				   having count(*)>= all(select count(*)
  9  							 from item_list
 10  							 group by item)));

PID             FLAVOR     FOOD            PRICE                                
--------------- ---------- ---------- ----------                                
90-APP-11       Apple      Tart             3.25                                

SQL> 
SQL> REM 4.Show the number of receipts that contain the product whose price is more than the average price of its food.
SQL> 
SQL> select count(distinct rno ) as "number of reciepts"
  2  from item_list
  3  where item in (select pid
  4  		   from products outer
  5  		    where price> (select avg(price)
  6  				  from products
  7  				  group by food
  8  				  having food=outer.food));

number of reciepts                                                              
------------------                                                              
               137                                                              

SQL> 
SQL> REM 5.Display the customer details along with receipt number and date for the receipts that are dated on the last day of the receipt month
SQL> 
SQL> select * from Customers
  2  natural join (select rdate, cid
  3  from receipts
  4  where rdate=LAST_DAY(rdate));

       CID FNAME                LNAME                RDATE                      
---------- -------------------- -------------------- ---------                  
         1 LOGAN                JULIET               31-OCT-07                  
         3 ESPOSITA             TRAVIS               31-OCT-07                  
        11 STADICK              MIGDALIA             31-OCT-07                  
        12 MCMAHAN              MELLIE               31-OCT-07                  
        19 STENZ                NATACHA              31-OCT-07                  
        20 ZEME                 STEPHEN              31-OCT-07                  

6 rows selected.

SQL> 
SQL> REM 6.Display the receipt number(s) and its total price for the receipt(s) that contain Twist as one among five items. Include only the receipts with total price more than $25.
SQL> 
SQL> select i.rno, sum(price)
  2  from item_list i, products p
  3  where p.pid=i.item  and i.rno in
  4  (select rno
  5  from item_list
  6  where item=(select pid
  7  		 from products
  8  		 where food='Twist'))
  9  group by i.rno
 10  having sum(price)>25 and count(ordinal)=5;

       RNO SUM(PRICE)                                                           
---------- ----------                                                           
     17729      25.55                                                           
     64477      25.35                                                           
     83085      48.25                                                           

SQL> 
SQL> 
SQL> 
SQL> REM 7.Display the details (customer details, receipt number, item) for the product that was purchased by the least number of customers.
SQL> 
SQL> select *
  2  from Customers c, Receipts r, item_list i
  3  where c.cid=r.cid and i.rno=r.rno and i.item in(select item
  4  						     from item_list
  5  						     having count(*) =(select min(count(*))
  6  								       from item_list group by item)
  7  								       group by item);

       CID FNAME                LNAME                       RNO RDATE           
---------- -------------------- -------------------- ---------- ---------       
       CID        RNO    ORDINAL ITEM                                           
---------- ---------- ---------- ---------------                                
        18 DOMKOWSKI            ALMETA                    73716 29-OCT-07       
        18      73716          4 50-CH                                          
                                                                                
         8 HELING               RUPERT                    95962 26-OCT-07       
         8      95962          3 50-CH                                          
                                                                                
         6 SLINGLAND            JOSETTE                   99994 21-OCT-07       
         6      99994          4 50-CH                                          
                                                                                

       CID FNAME                LNAME                       RNO RDATE           
---------- -------------------- -------------------- ---------- ---------       
       CID        RNO    ORDINAL ITEM                                           
---------- ---------- ---------- ---------------                                
        18 DOMKOWSKI            ALMETA                    82056 07-OCT-07       
        18      82056          2 50-CH                                          
                                                                                
        14 SOPKO                RAYFORD                   77032 28-OCT-07       
        14      77032          1 50-CH                                          
                                                                                
        20 ZEME                 STEPHEN                   49845 31-OCT-07       
        20      49845          3 50-CH                                          
                                                                                

6 rows selected.

SQL> 
SQL> 
SQL> 
SQL> REM 8.Display the customer details along with the receipt number who ordered all the flavors of Meringue in the same receipt.
SQL> 
SQL> select c.cid,lname,fname,rno
  2  from customers c,receipts r
  3  where c.cid=r.cid and r.rno in(select rno
  4  				    from receipts
  5  				    where rno in(select rno
  6  						 from item_list
  7  						 join products on (pid = item )where item in(select pid
  8  											     from products
  9  											     where food='Meringue')
 10  											     group by rno having count(distinct item)=(select count(distinct flavor )
 11  																       from products
 12  																       where food='Meringue'))) ;

       CID LNAME                FNAME                       RNO                 
---------- -------------------- -------------------- ----------                 
         8 RUPERT               HELING                    61797                 

SQL> 
SQL> REM 9.Display the product details of both Pie and Bear Claw.
SQL> 
SQL> select * from products
  2  where food='Pie'
  3  UNION
  4  select * from products
  5  where food='Bear Claw';

PID             FLAVOR     FOOD            PRICE                                
--------------- ---------- ---------- ----------                                
51-BC           Almond     Bear Claw        1.95                                
90-APIE-10      Apple      Pie              5.25                                

SQL> 
SQL> REM 10.Display the customers details who havent placed any orders
SQL> 
SQL> select *
  2  from customers
  3  minus (select * from customers
  4  	     where cid in( select cid
  5  			   from receipts ));

no rows selected

SQL> 
SQL> REM 11.Display the food that has the same flavor as that of the common flavor between the Meringue and Tart.
SQL> 
SQL> select food
  2  from products
  3  where flavor IN (select flavor
  4  		      from products
  5  		      where food ='Tart'
  6  		      INTERSECT
  7  		      select flavor
  8  		      from products
  9  		      where food='Meringue')
 10  and food not in ('Tart','Meringue');

FOOD                                                                            
----------                                                                      
Cake                                                                            
Eclair                                                                          
Croissant                                                                       

SQL> spool off;
